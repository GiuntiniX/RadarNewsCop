<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Radar de Not√≠cias</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1112;
      --panel:#151718;
      --muted:#9aa3a8;
      --accent1:#00aced;
      --accent2:#00c853;
      --accent3:#ff9100;
      --accent4:#9c27b0;
      --card:#ffffff;
      --card-text:#111;
      --btn-disabled: #444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:#e8eef0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    header{
      background:linear-gradient(180deg, #141619 0%, #111214 100%);
      border-bottom:1px solid rgba(255,255,255,0.03);
      padding:14px 16px;
      position:sticky;
      top:0;
      z-index:40;
    }
    .header-inner{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .brand img{width:36px;height:36px}
    .brand .title{font-weight:700;font-size:1.15rem;color:var(--accent1)}
    .meta{
      color:var(--muted);
      font-size:0.94rem;
    }
    .meta a{color:var(--accent1); text-decoration:underline}

    /* Menu editorias (grid, elegante) */
    .editorias-wrap{
      width:100%;
      max-width:1100px;
      margin:10px auto 0;
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }
    .editorias-row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .editoria-btn{
      padding:8px 12px;
      border-radius:10px;
      border:0;
      cursor:pointer;
      color:#fff;
      font-weight:600;
      font-size:0.95rem;
      transition:transform .12s ease, box-shadow .12s ease, opacity .12s;
      box-shadow:0 4px 10px rgba(2,6,10,0.45);
    }
    .editoria-btn:active{transform:translateY(1px)}
    .editoria-btn[disabled]{opacity:.5; cursor:not-allowed; box-shadow:none}
    .editoria-btn.small{padding:6px 9px; font-size:0.88rem}

    /* color classes */
    .c1{background:linear-gradient(90deg,var(--accent1),#48d6ff)}
    .c2{background:linear-gradient(90deg,var(--accent2),#6df3a3); color:#07130a}
    .c3{background:linear-gradient(90deg,var(--accent3),#ffd180); color:#2a1800}
    .c4{background:linear-gradient(90deg,var(--accent4),#d8a8e6); color:#2b0e2b}
    .c5{background:linear-gradient(90deg,var(--accent1),#ff6b6b)}
    .c6{background:linear-gradient(90deg,#607d8b,#b0bec5); color:#081018}
    .c7{background:linear-gradient(90deg,#03A9F4,#81d4fa); color:#071526}

    /* Busca / a√ß√µes */
    .actions{
      max-width:1100px;
      margin:10px auto;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }
    .actions input[type="text"]{
      padding:9px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      background:transparent;
      color:inherit;
      min-width:220px;
      outline:none;
    }
    .actions .btn{
      padding:9px 12px;
      border-radius:10px;
      border:0;
      cursor:pointer;
      font-weight:700;
      background:var(--accent1);
      color:#061114;
      box-shadow:0 6px 16px rgba(0,172,237,0.14);
    }
    .actions .btn.alt{background:transparent;color:var(--accent1);border:1px solid rgba(255,255,255,0.04)}
    .timer{
      color:var(--muted);
      font-size:0.92rem;
      display:flex;
      gap:8px;
      align-items:center;
    }

    /* Layout principal */
    .container{
      max-width:1100px;
      margin:18px auto 60px;
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:18px;
      align-items:start;
    }
    .main{
      min-height:300px;
    }
    .card{
      background:var(--card);
      color:var(--card-text);
      padding:12px 14px;
      border-radius:10px;
      margin-bottom:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.45);
      border-left:6px solid var(--accent1);
    }
    .card h3{margin:0 0 6px;font-size:1rem}
    .card p{margin:0 8px 0; color:#333; font-size:0.95rem}
    .card small{color:#666}

    /* sidebar */
    .sidebar{
      position:relative;
    }
    .sidebar h4{color:var(--accent1); margin:0 0 8px; text-align:center}
    .sidebar .item{
      background:var(--panel);
      border-radius:8px;
      padding:10px;
      margin-bottom:10px;
      font-size:0.95rem;
      color:var(--muted);
      border-left:4px solid rgba(255,255,255,0.03);
    }
    .sidebar .item a{color:#9be9ff; text-decoration:underline; font-weight:600}

    /* responsive */
    @media (max-width:1100px){
      .container{grid-template-columns:1fr 300px}
      .container-main{padding:0 16px}
    }
    @media (max-width:820px){
      .container{grid-template-columns:1fr}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="brand">
          <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f6f0.png" alt="Radar" />
          <div>
            <div class="title">Radar de Not√≠cias</div>
            <div class="meta" style="font-size:0.82rem">Desenvolvido por <a href="mailto:guilherme.giuntini@telefonica.com">Guilherme Giuntini</a></div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:14px;align-items:center;flex-wrap:wrap">
        <div class="timer" id="refresh-timer">‚è≥ Atualiza√ß√£o autom√°tica em --:--</div>
        <button class="btn alt" id="btn-refresh" onclick="refreshNoticias()">üîÑ Atualizar agora</button>
      </div>
    </div>

    <!-- Editorias -->
    <div class="editorias-wrap" aria-hidden="false">
      <div id="menuEditoriasTop" class="editorias-row" role="navigation" aria-label="Editorias - linha 1"></div>
      <div id="menuEditoriasBottom" class="editorias-row" role="navigation" aria-label="Editorias - linha 2"></div>
    </div>

    <!-- A√ß√µes -->
    <div class="actions" role="search">
      <input id="termoBusca" type="text" placeholder="Buscar por palavra-chave (ex: futebol, celebridades, A Fazenda)" />
      <button class="btn" onclick="buscarPorPalavra()">Buscar</button>
      <div style="width:8px"></div>
    </div>
  </header>

  <div class="container">
    <main class="main" id="noticias" aria-live="polite">
      <!-- Not√≠cias carregadas aqui -->
    </main>

    <aside class="sidebar" aria-label="Mais publicadas">
      <h4>Mais publicadas (√∫ltimas 5h)</h4>
      <div id="mais-publicadas"></div>
    </aside>
  </div>

<script>
/*
  Altera√ß√µes aplicadas:
  - Robustez nos bot√µes: desabilita todos enquanto carrega para evitar cliques paralelos.
  - Filtragem por "data de hoje" (not√≠cias cuja data local corresponde ao dia atual).
  - Fallback autom√°tico: se uma editoria n√£o retornar not√≠cias de hoje, tenta o feed geral do Google News (*) antes de mostrar mensagem.
  - UI: menu elegante, duas linhas coloridas, estado disabled vis√≠vel.
  - Sidebar mant√©m as "Mais publicadas" com janela de 5 horas.
*/

const feeds = [
  { nome: 'Tudo (GoogleNews *)', url: 'https://news.google.com/rss/search?q=*&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:7 },
  { nome: 'Todas Not√≠cias', url: 'https://news.google.com/rss?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:7 },

  { nome: 'Geral', url: 'https://news.google.com/rss/headlines/section/topic/NATION.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:1 },
  { nome: 'Brasil', url: 'https://news.google.com/rss/headlines/section/geo/Brasil?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:1 },
  { nome: 'Mundo', url: 'https://news.google.com/rss/headlines/section/topic/WORLD.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:1 },
  { nome: 'Pol√≠tica', url: 'https://news.google.com/rss/headlines/section/topic/POLITICS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:1 },
  { nome: 'Economia', url: 'https://news.google.com/rss/headlines/section/topic/BUSINESS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:1 },

  { nome: 'Ci√™ncia', url: 'https://news.google.com/rss/headlines/section/topic/SCIENCE.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:2 },
  { nome: 'Sa√∫de', url: 'https://news.google.com/rss/headlines/section/topic/HEALTH.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:2 },
  { nome: 'Educa√ß√£o', url: 'https://news.google.com/rss/search?q=educa√ß√£o&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:2 },

  { nome: 'Entretenimento', url: 'https://news.google.com/rss/headlines/section/topic/ENTERTAINMENT.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:3 },
  { nome: 'Celebridades', url: 'https://news.google.com/rss/search?q=celebridades&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:3 },
  { nome: 'A Fazenda', url: 'https://news.google.com/rss/search?q=a+fazenda&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:3 },
  { nome: 'Fofocas', url: 'https://news.google.com/rss/search?q=fofoca+celebridades&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:3 },

  { nome: 'Esportes', url: 'https://news.google.com/rss/headlines/section/topic/SPORTS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:4 },
  { nome: 'Futebol', url: 'https://news.google.com/rss/search?q=futebol&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:4 },
  { nome: 'Futebol Feminino', url: 'https://news.google.com/rss/search?q=futebol+feminino&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:4 },

  { nome: 'Tecnologia', url: 'https://news.google.com/rss/headlines/section/topic/TECHNOLOGY.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:5 },
  { nome: 'Startups', url: 'https://news.google.com/rss/search?q=startups&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo:5 },

  // Alguns portais diretos (regionais/grandes)
  { nome: 'G1', url: 'https://g1.globo.com/rss/g1/', grupo:6 },
  { nome: 'UOL', url: 'https://noticias.uol.com.br/ultimas/index.xml', grupo:6 },
  { nome: 'GloboEsporte', url: 'https://globoesporte.globo.com/rss/ultimas.xml', grupo:6 }
];

// layout: dividir em duas linhas (top/bottom) para menu
const menuTop = document.getElementById('menuEditoriasTop');
const menuBottom = document.getElementById('menuEditoriasBottom');

// color class mapping by grupo
const colorMap = {1:'c1',2:'c2',3:'c3',4:'c4',5:'c6',6:'c5',7:'c7'};

let noticiasAtuais = [];
let editoriaSelecionada = "Todas";
let isLoading = false;

// util: verifica se pubDate pertence ao dia local "hoje"
function isDateToday(pubDateStr){
  if(!pubDateStr) return false;
  const d = new Date(pubDateStr);
  if(isNaN(d)) return false;
  const now = new Date();
  return d.getFullYear() === now.getFullYear()
      && d.getMonth() === now.getMonth()
      && d.getDate() === now.getDate();
}

function formatarDataAMPM(dataStr){
  if(!dataStr) return '';
  const d = new Date(dataStr);
  if(isNaN(d)) return '';
  return d.toLocaleString('pt-BR', {day:'2-digit',month:'2-digit',year:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false}).replace(',', ' -');
}

function setButtonsDisabled(disabled){
  const buttons = document.querySelectorAll('.editoria-btn');
  buttons.forEach(b => b.disabled = disabled);
  isLoading = disabled;
}

/* render do menu: elegante, duas linhas */
function renderMenu(){
  menuTop.innerHTML = '';
  menuBottom.innerHTML = '';

  // bot√£o Todas no topo
  const btnTodas = document.createElement('button');
  btnTodas.className = `editoria-btn ${colorMap[1]}`;
  btnTodas.textContent = 'Todas (hoje)';
  btnTodas.onclick = () => carregarTodasHoje();
  if(editoriaSelecionada === 'Todas') btnTodas.style.boxShadow = '0 8px 26px rgba(0,172,237,0.18)';
  menuTop.appendChild(btnTodas);

  // dividir feeds em duas metades para top/bottom, mantendo ordem est√°vel
  const half = Math.ceil(feeds.length/2);
  const topFeeds = feeds.slice(0, half);
  const bottomFeeds = feeds.slice(half);

  topFeeds.forEach(f => {
    const btn = document.createElement('button');
    btn.className = `editoria-btn ${colorMap[f.grupo] || 'c1'}`;
    btn.textContent = f.nome;
    btn.title = f.url;
    btn.onclick = () => carregarNoticiasEditoriaHoje(f.nome);
    menuTop.appendChild(btn);
  });
  bottomFeeds.forEach(f => {
    const btn = document.createElement('button');
    btn.className = `editoria-btn small ${colorMap[f.grupo] || 'c1'}`;
    btn.textContent = f.nome;
    btn.title = f.url;
    btn.onclick = () => carregarNoticiasEditoriaHoje(f.nome);
    menuBottom.appendChild(btn);
  });
}

/* exibir lista simples (um por card) */
function exibirNoticiasSimples(lista){
  const painel = document.getElementById('noticias');
  painel.innerHTML = '';
  let total = 0;
  lista.forEach(item => {
    try {
      const title = item.querySelector('title')?.textContent || '(sem t√≠tulo)';
      const link = item.querySelector('link')?.textContent || '#';
      const desc = item.querySelector('description')?.textContent || '';
      const pub = item.querySelector('pubDate')?.textContent || '';
      const card = document.createElement('article');
      card.className = 'card';
      card.innerHTML = `<h3><a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a></h3>
                        <small>üïí ${pub ? formatarDataAMPM(pub) : ''}</small>
                        <p>${desc}</p>`;
      painel.appendChild(card);
      total++;
    } catch(e){}
  });
  atualizarContador(total);
}

/* contador */
function atualizarContador(q){
  const el = document.querySelector('header .header-inner .meta');
  // tamb√©m mostrar total abaixo do menu
  const existing = document.getElementById('contador-hoje');
  if(existing){
    existing.textContent = `üî¢ Not√≠cias carregadas hoje: ${q}`;
  } else {
    const cont = document.createElement('div');
    cont.id = 'contador-hoje';
    cont.style.color = 'var(--muted)';
    cont.style.fontSize = '0.95rem';
    cont.style.marginTop = '8px';
    cont.textContent = `üî¢ Not√≠cias carregadas hoje: ${q}`;
    document.querySelector('.editorias-wrap').appendChild(cont);
  }
}

/* fetch via allorigins (CORS proxy) */
async function fetchRss(url){
  try{
    const resp = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
    if(!resp.ok) throw new Error('proxy-fail');
    const data = await resp.json();
    const parser = new DOMParser();
    const xml = parser.parseFromString(data.contents, 'application/xml');
    const items = Array.from(xml.querySelectorAll('item'));
    return items;
  }catch(e){
    console.warn('Erro ao buscar feed', url, e);
    return [];
  }
}

/* carregar todas as not√≠cias, mas filtradas para "hoje" */
async function carregarTodasHoje(){
  if(isLoading) return;
  setButtonsDisabled(true);
  editoriaSelecionada = 'Todas';
  renderMenu();
  document.getElementById('noticias').innerHTML = `<div style="color:var(--muted);padding:12px;background:transparent;border-radius:8px">Carregando not√≠cias de hoje...</div>`;
  let todas = [];
  const promises = feeds.map(f => fetchRss(f.url).then(items => {
    if(items && items.length) todas = todas.concat(items);
  }));
  await Promise.all(promises);
  // filtrar s√≥ as de hoje (data local)
  const filtradas = todas.filter(it => isDateToday(it.querySelector('pubDate')?.textContent));
  // ordenar por data desc
  filtradas.sort((a,b)=> new Date(b.querySelector('pubDate')?.textContent||0) - new Date(a.querySelector('pubDate')?.textContent||0));
  noticiasAtuais = filtradas;
  if(filtradas.length === 0){
    // tentar fallback com feed '*' espec√≠fico para hoje (em caso de feeds com problemas)
    const fallback = await fetchRss('https://news.google.com/rss/search?q=*&hl=pt-BR&gl=BR&ceid=BR:pt-419');
    const fbToday = fallback.filter(it => isDateToday(it.querySelector('pubDate')?.textContent));
    if(fbToday.length){
      noticiasAtuais = fbToday.sort((a,b)=> new Date(b.querySelector('pubDate')?.textContent||0) - new Date(a.querySelector('pubDate')?.textContent||0));
      exibirNoticiasSimples(noticiasAtuais);
      atualizarMaisPublicadas();
      setButtonsDisabled(false);
      return;
    }
    document.getElementById('noticias').innerHTML = `<div style="color:var(--muted);padding:12px;background:transparent;border-radius:8px">Nenhuma not√≠cia encontrada para HOJE em todas as editorias.</div>`;
    atualizarContador(0);
    atualizarMaisPublicadas();
    setButtonsDisabled(false);
    return;
  }
  exibirNoticiasSimples(noticiasAtuais);
  atualizarMaisPublicadas();
  setButtonsDisabled(false);
}

/* carregar not√≠cias de uma editoria, filtradas para hoje. se n√£o achar, faz fallback */
async function carregarNoticiasEditoriaHoje(nomeEditoria){
  if(isLoading) return;
  setButtonsDisabled(true);
  editoriaSelecionada = nomeEditoria;
  renderMenu();
  document.getElementById('noticias').innerHTML = `<div style="color:var(--muted);padding:12px;background:transparent;border-radius:8px">Carregando not√≠cias de <b>${nomeEditoria}</b> (apenas HOJE)...</div>`;
  const feed = feeds.find(f=>f.nome === nomeEditoria);
  if(!feed){
    await carregarTodasHoje();
    setButtonsDisabled(false);
    return;
  }
  const items = await fetchRss(feed.url);
  let hoje = items.filter(it => isDateToday(it.querySelector('pubDate')?.textContent));
  // ordenar
  hoje.sort((a,b)=> new Date(b.querySelector('pubDate')?.textContent||0) - new Date(a.querySelector('pubDate')?.textContent||0));
  noticiasAtuais = hoje;
  if(hoje.length === 0){
    // fallback para feed geral '*' para tentar obter not√≠cias de hoje
    const fallback = await fetchRss('https://news.google.com/rss/search?q=*&hl=pt-BR&gl=BR&ceid=BR:pt-419');
    const fbToday = fallback.filter(it => isDateToday(it.querySelector('pubDate')?.textContent));
    if(fbToday.length > 0){
      noticiasAtuais = fbToday.sort((a,b)=> new Date(b.querySelector('pubDate')?.textContent||0) - new Date(a.querySelector('pubDate')?.textContent||0));
      exibirNoticiasSimples(noticiasAtuais);
      atualizarMaisPublicadas();
      setButtonsDisabled(false);
      return;
    }
    document.getElementById('noticias').innerHTML = `<div style="color:var(--muted);padding:12px;background:transparent;border-radius:8px">Nenhuma not√≠cia encontrada para HOJE em <b>${nomeEditoria}</b>.</div>`;
    atualizarContador(0);
    atualizarMaisPublicadas();
    setButtonsDisabled(false);
    return;
  }
  exibirNoticiasSimples(noticiasAtuais);
  atualizarMaisPublicadas();
  setButtonsDisabled(false);
}

/* busca por palavra (usa Google News Search, filtrando por hoje) */
async function buscarPorPalavra(){
  const termo = document.getElementById('termoBusca').value.trim();
  if(!termo){
    if(editoriaSelecionada === 'Todas') return carregarTodasHoje();
    return carregarNoticiasEditoriaHoje(editoriaSelecionada);
  }
  if(isLoading) return;
  setButtonsDisabled(true);
  document.getElementById('noticias').innerHTML = `<div style="color:var(--muted);padding:12px;background:transparent;border-radius:8px">Buscando "${termo}" em not√≠cias de hoje...</div>`;
  const rssBusca = `https://news.google.com/rss/search?q=${encodeURIComponent(termo)}&hl=pt-BR&gl=BR&ceid=BR:pt-419`;
  const items = await fetchRss(rssBusca);
  const hoje = items.filter(it => isDateToday(it.querySelector('pubDate')?.textContent));
  hoje.sort((a,b)=> new Date(b.querySelector('pubDate')?.textContent||0) - new Date(a.querySelector('pubDate')?.textContent||0));
  noticiasAtuais = hoje;
  if(hoje.length === 0){
    document.getElementById('noticias').innerHTML = `<div style="color:var(--muted);padding:12px;background:transparent;border-radius:8px">Nenhuma not√≠cia de HOJE encontrada para "${termo}".</div>`;
    atualizarContador(0);
    atualizarMaisPublicadas();
    setButtonsDisabled(false);
    return;
  }
  exibirNoticiasSimples(noticiasAtuais);
  atualizarMaisPublicadas();
  setButtonsDisabled(false);
}

/* auto refresh (15min) com contador */
let refreshInterval = 15 * 60; // segundos
let refreshCountdown = refreshInterval;
let refreshTimerId = null;
function atualizarTimerRefresh(){
  const el = document.getElementById('refresh-timer');
  if(!el) return;
  const m = Math.floor(refreshCountdown/60).toString().padStart(2,'0');
  const s = (refreshCountdown%60).toString().padStart(2,'0');
  el.textContent = `‚è≥ Atualiza√ß√£o autom√°tica em ${m}:${s}`;
}
function iniciarAutoRefresh(){
  if(refreshTimerId) clearInterval(refreshTimerId);
  refreshCountdown = refreshInterval;
  atualizarTimerRefresh();
  refreshTimerId = setInterval(()=>{
    refreshCountdown--;
    if(refreshCountdown <= 0){
      refreshCountdown = refreshInterval;
      // refresca a editoria atual (ou todas)
      if(editoriaSelecionada === 'Todas') carregarTodasHoje();
      else carregarNoticiasEditoriaHoje(editoriaSelecionada);
    }
    atualizarTimerRefresh();
  }, 1000);
}
function refreshNoticias(){
  if(editoriaSelecionada === 'Todas') carregarTodasHoje();
  else carregarNoticiasEditoriaHoje(editoriaSelecionada);
  refreshCountdown = refreshInterval;
  atualizarTimerRefresh();
}

/* sidebar: mais publicadas √∫ltimas 5 horas (agrupa t√≠tulos similares/tipos) */
async function atualizarMaisPublicadas(){
  const agora = new Date();
  const cincoHorasAtras = new Date(agora.getTime() - 5*60*60*1000);
  const container = document.getElementById('mais-publicadas');
  container.innerHTML = '';
  if(!noticiasAtuais || noticiasAtuais.length === 0){
    container.innerHTML = `<div style="color:var(--muted)">Sem dados recentes.</div>`;
    return;
  }
  const mapa = {};
  noticiasAtuais.forEach(item=>{
    try{
      const pub = new Date(item.querySelector('pubDate')?.textContent||0);
      if(isNaN(pub) || pub < cincoHorasAtras) return;
      let title = (item.querySelector('title')?.textContent || '').trim();
      if(!title) return;
      const key = title.toLowerCase().replace(/[^\w\s]/g,'').substring(0,140);
      if(!mapa[key]) mapa[key] = {count:0, item, latest:pub};
      mapa[key].count++;
      if(pub > mapa[key].latest) mapa[key].latest = pub;
    }catch(e){}
  });
  const list = Object.values(mapa).sort((a,b)=> b.count - a.count || b.latest - a.latest).slice(0,12);
  if(list.length === 0){
    container.innerHTML = `<div style="color:var(--muted)">Sem publica√ß√µes nas √∫ltimas 5 horas.</div>`;
    return;
  }
  list.forEach(entry=>{
    const item = entry.item;
    const title = item.querySelector('title')?.textContent || '(sem t√≠tulo)';
    const link = item.querySelector('link')?.textContent || '#';
    const pub = item.querySelector('pubDate')?.textContent || '';
    const host = (() => { try { return new URL(link).hostname.replace('www.',''); } catch(e) { return ''; } })();
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `<a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a>
                     <div style="margin-top:6px;color:var(--muted);font-size:0.88rem">üóû ${host} ‚Ä¢ ${formatarDataAMPM(pub)} ${entry.count>1?` ‚Ä¢ √ó${entry.count}`:''}</div>`;
    container.appendChild(div);
  });
}

/* inicializa√ß√£o UI + carregar tudo HOJE */
function init(){
  renderMenu();
  carregarTodasHoje();
  iniciarAutoRefresh();
}

/* monta menu ao carregar a p√°gina */
init();
</script>
</body>
</html>
