<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Radar de Not√≠cias</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    header {
      background: #1e1e1e;
      color: white;
      padding: 1em;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .titulo-radar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5em;
      font-size: 1.5em;
    }
    .titulo-radar img {
      width: 32px;
      height: 32px;
      vertical-align: middle;
    }

    /* MENU DE EDITORIA */
    nav.menu-editorias {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5em;
      margin: 1em 0 0.5em 0;
    }
    .menu-editorias button {
      background: #23272b;
      color: #fff;
      border: none;
      border-radius: 5px 5px 0 0;
      padding: 0.5em 1em;
      margin: 0;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.2s;
      outline: none;
    }
    .menu-editorias button.selected,
    .menu-editorias button:hover {
      background: #00aced;
      color: #fff;
      font-weight: bold;
    }

    .busca {
      text-align: center;
      margin: 1em 0;
      flex-wrap: wrap;
    }
    .busca button {
      margin: 5px;
      padding: 0.5em 1em;
      background: #00aced;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      outline: none;
    }
    .busca button:hover {
      background: #0077a3;
    }
    .busca input {
      padding: 0.5em;
      width: 200px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .contador {
      text-align: center;
      font-weight: bold;
      margin: 1em 0;
    }
    .sessao-data {
      margin: 2em 0 1em 0;
      color: #fff;
      font-size: 1.1em;
      font-weight: bold;
      text-align: left;
      border-bottom: 1px solid #333;
      padding-bottom: 0.2em;
    }
    #noticias {
      display: flex;
      flex-direction: column;
      gap: 2em;
      padding: 1em;
    }
    .cards-agrupados {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1em;
    }
    .card {
      background: #ffffff;
      color: #000000;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(255,255,255,0.1);
      position: relative;
      border-left: 8px solid transparent;
      transition: border-color 0.2s;
    }
    .card.breaking {
      border-left: 8px solid #ff2e00;
      background: #fff3f0;
      animation: destaque 1s infinite alternate;
    }
    @keyframes destaque {
      from { box-shadow: 0 0 16px 2px #ff2e0033; }
      to { box-shadow: 0 0 24px 4px #ff2e0022; }
    }
    .breaking-label {
      position: absolute;
      top: 8px;
      left: -1px;
      background: #ff2e00;
      color: #fff;
      font-size: 0.95em;
      padding: 2px 8px;
      border-radius: 0 4px 4px 0;
      font-weight: bold;
      z-index: 2;
    }
    .card h3 {
      margin: 0.5em 0;
    }
    .card p {
      color: #333;
    }
    @media (max-width: 600px) {
      .menu-editorias {
        flex-direction: column;
        gap: 0;
      }
      .menu-editorias button {
        border-radius: 0;
        margin-bottom: 2px;
        width: 100%;
      }
      .busca button {
        width: 90%;
        margin: 5px auto;
        display: block;
      }
      .busca input {
        width: 90%;
      }
      .cards-agrupados {
        grid-template-columns: 1fr;
      }
      .titulo-radar {
        font-size: 1.1em;
      }
      .titulo-radar img {
        width: 24px;
        height: 24px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="titulo-radar">
      <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f6f0.png" alt="Radar Icon" />
      <span>Radar de Not√≠cias</span>
    </div>
    <!-- MENU DE EDITORIAS -->
    <nav class="menu-editorias" id="menuEditorias">
      <!-- Os bot√µes ser√£o inseridos via JS -->
    </nav>
    <div class="busca">
      <input type="text" id="termoBusca" placeholder="Buscar por palavra-chave">
      <button onclick="buscarPorPalavra()">Buscar</button>
    </div>
    <div class="contador" id="contador"></div>
  </header>
  <main id="noticias"></main>
  <script>
const feeds = [
  { nome: 'Geral', url: 'https://news.google.com/rss?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Mundo', url: 'https://news.google.com/rss/headlines/section/topic/WORLD.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Pol√≠tica', url: 'https://news.google.com/rss/headlines/section/topic/POLITICS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Neg√≥cios', url: 'https://news.google.com/rss/headlines/section/topic/BUSINESS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Ci√™ncia', url: 'https://news.google.com/rss/headlines/section/topic/SCIENCE.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Sa√∫de', url: 'https://news.google.com/rss/headlines/section/topic/HEALTH.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Tecnologia', url: 'https://news.google.com/rss/headlines/section/topic/TECHNOLOGY.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Esportes', url: 'https://news.google.com/rss/headlines/section/topic/SPORTS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Entretenimento', url: 'https://news.google.com/rss/headlines/section/topic/ENTERTAINMENT.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Brasil', url: 'https://news.google.com/rss/headlines/section/geo/Brasil?hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Economia', url: 'https://news.google.com/rss/search?q=economia&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Educa√ß√£o', url: 'https://news.google.com/rss/search?q=educa√ß√£o&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Carreira', url: 'https://news.google.com/rss/search?q=carreira&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Meio Ambiente', url: 'https://news.google.com/rss/search?q=meio+ambiente&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Arte', url: 'https://news.google.com/rss/search?q=arte&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Opini√£o', url: 'https://news.google.com/rss/search?q=opini√£o&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Moda', url: 'https://news.google.com/rss/search?q=moda&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Culin√°ria', url: 'https://news.google.com/rss/search?q=culin√°ria&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Turismo', url: 'https://news.google.com/rss/search?q=turismo&hl=pt-BR&gl=BR&ceid=BR:pt-419' },
  { nome: 'Religi√£o', url: 'https://news.google.com/rss/search?q=religi√£o&hl=pt-BR&gl=BR&ceid=BR:pt-419' }
];

let noticiasAtuais = [];
let noticiasPorData = {};
let editoriaSelecionada = "Todas"; // "Todas" = todos os feeds

function atualizarContador(qtd) {
  document.getElementById("contador").textContent = `üî¢ Total de not√≠cias exibidas: ${qtd}`;
}

function formatarDataAMPM(dataStr) {
  if (!dataStr) return "";
  const data = new Date(dataStr);
  if (isNaN(data)) return "";
  return data.toLocaleString('pt-BR', {
    day: '2-digit', month: '2-digit', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
  }).replace(',', ' -');
}

function isBreakingNews(title, description) {
  const crits = /(\burgente\b|\bbreaking\b|√∫ltima hora|alerta|emerg√™ncia|importante)/i;
  if (crits.test(title) || crits.test(description)) return true;
  if (/BREAKING NEWS/i.test(description)) return true;
  if (title.length < 50 && /^[A-Z√Å√â√ç√ì√ö√Ç√ä√î√É√ï√á0-9 \-!?:]+$/.test(title)) return true;
  return false;
}

// Agrupar por: √∫ltimo minuto, hoje, ontem, semana, m√™s
function agruparPorDatas(lista) {
  const agora = new Date();
  const hoje = new Date(agora); hoje.setHours(0,0,0,0);
  const ontem = new Date(hoje); ontem.setDate(hoje.getDate()-1);
  const semana = new Date(hoje); semana.setDate(hoje.getDate()-7);

  const grupos = {
    '√∫ltimo segundo': [],
    '√∫ltimo minuto': [],
    'hoje': [],
    'ontem': [],
    '√∫ltima semana': [],
    'anteriores': []
  };

  lista.forEach(item => {
    const pubDate = item.querySelector("pubDate")?.textContent;
    if (!pubDate) return;
    const dataNoticia = new Date(pubDate);
    const diffSeg = Math.floor((agora.getTime() - dataNoticia.getTime())/1000);
    const diffMin = Math.floor(diffSeg/60);

    if (diffSeg <= 1) {
      grupos['√∫ltimo segundo'].push(item);
    } else if (diffMin < 1) {
      grupos['√∫ltimo minuto'].push(item);
    } else {
      const localNoticia = new Date(dataNoticia.getFullYear(), dataNoticia.getMonth(), dataNoticia.getDate());
      if (localNoticia.getTime() === hoje.getTime()) {
        grupos['hoje'].push(item);
      } else if (localNoticia.getTime() === ontem.getTime()) {
        grupos['ontem'].push(item);
      } else if (localNoticia >= semana) {
        grupos['√∫ltima semana'].push(item);
      } else {
        grupos['anteriores'].push(item);
      }
    }
  });
  return grupos;
}

function exibirNoticiasAgrupadas(grupos) {
  const noticias = document.getElementById("noticias");
  noticias.innerHTML = "";
  let total = 0;
  const ordem = ['√∫ltimo segundo', '√∫ltimo minuto', 'hoje', 'ontem', '√∫ltima semana', 'anteriores'];
  ordem.forEach(grupo => {
    const lista = grupos[grupo];
    if (!lista || !lista.length) return;
    total += lista.length;
    const sessao = document.createElement('section');
    sessao.className = 'sessao-data';
    sessao.innerHTML = `<div>${grupo.toUpperCase()} (${lista.length})</div>`;
    const cards = document.createElement('div');
    cards.className = 'cards-agrupados';

    let breaking = lista.filter(item => {
      const title = item.querySelector("title")?.textContent || "";
      const desc = item.querySelector("description")?.textContent || "";
      return isBreakingNews(title, desc);
    }).slice(0,3);
    let restantes = lista.filter(item => !breaking.includes(item));
    let final = breaking.concat(restantes);

    final.forEach(item => {
      try {
        const title = item.querySelector("title").textContent;
        const link = item.querySelector("link").textContent;
        const description = item.querySelector("description")?.textContent || "";
        const pubDate = item.querySelector("pubDate")?.textContent || "";
        const breaking = isBreakingNews(title, description);
        const card = document.createElement("div");
        card.className = "card" + (breaking ? " breaking" : "");
        card.innerHTML = `
          ${breaking ? '<span class="breaking-label">DESTAQUE</span>' : ''}
          <h3><a href="${link}" target="_blank">${title}</a></h3>
          <small style="color:#666;">${pubDate ? ('üïí ' + formatarDataAMPM(pubDate)) : ''}</small>
          <p>${description}</p>
        `;
        cards.appendChild(card);
      } catch (e) {}
    });
    sessao.appendChild(cards);
    noticias.appendChild(sessao);
  });
  atualizarContador(total);
}

// Carrega not√≠cias de todos os feeds, exibe agrupadas
async function carregarTodasNoticiasAgrupadas() {
  editoriaSelecionada = "Todas";
  atualizarMenuEditorias();
  document.getElementById("noticias").innerHTML = "<p>Carregando not√≠cias de todas as editorias...</p>";
  atualizarContador(0);

  let todasNoticias = [];
  for (const feed of feeds) {
    try {
      const resp = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(feed.url)}`);
      const data = await resp.json();
      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "application/xml");
      const items = Array.from(xml.querySelectorAll("item"));
      todasNoticias = todasNoticias.concat(items);
    } catch (err) {
      // Ignora erro de feed individual
    }
  }
  todasNoticias.sort((a, b) => {
    const dateA = new Date(a.querySelector("pubDate")?.textContent || 0);
    const dateB = new Date(b.querySelector("pubDate")?.textContent || 0);
    return dateB - dateA;
  });
  noticiasAtuais = todasNoticias;
  const grupos = agruparPorDatas(noticiasAtuais);
  exibirNoticiasAgrupadas(grupos);
}

// Carrega not√≠cias apenas de uma editoria espec√≠fica
async function carregarNoticiasEditoria(nomeEditoria) {
  editoriaSelecionada = nomeEditoria;
  atualizarMenuEditorias();
  document.getElementById("noticias").innerHTML = `<p>Carregando not√≠cias de <b>${nomeEditoria}</b>...</p>`;
  atualizarContador(0);

  const feed = feeds.find(f => f.nome === nomeEditoria);
  if (!feed) {
    carregarTodasNoticiasAgrupadas();
    return;
  }
  try {
    const resp = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(feed.url)}`);
    const data = await resp.json();
    const parser = new DOMParser();
    const xml = parser.parseFromString(data.contents, "application/xml");
    noticiasAtuais = Array.from(xml.querySelectorAll("item"));
    noticiasAtuais.sort((a, b) => {
      const dateA = new Date(a.querySelector("pubDate")?.textContent || 0);
      const dateB = new Date(b.querySelector("pubDate")?.textContent || 0);
      return dateB - dateA;
    });
    const grupos = agruparPorDatas(noticiasAtuais);
    exibirNoticiasAgrupadas(grupos);
  } catch (err) {
    document.getElementById("noticias").innerHTML = `<p>Erro ao carregar not√≠cias!</p>`;
  }
}

// Atualiza o menu, destacando o bot√£o selecionado
function atualizarMenuEditorias() {
  const nav = document.getElementById("menuEditorias");
  nav.innerHTML = "";
  // Adiciona bot√£o "Todas"
  const btnTodas = document.createElement("button");
  btnTodas.textContent = "Todas";
  btnTodas.className = (editoriaSelecionada === "Todas" ? "selected" : "");
  btnTodas.onclick = () => carregarTodasNoticiasAgrupadas();
  nav.appendChild(btnTodas);
  // Adiciona cada editoria
  feeds.forEach(feed => {
    const btn = document.createElement("button");
    btn.textContent = feed.nome;
    btn.className = (editoriaSelecionada === feed.nome ? "selected" : "");
    btn.onclick = () => carregarNoticiasEditoria(feed.nome);
    nav.appendChild(btn);
  });
}

// Busca por palavra-chave em todos feeds
function buscarPorPalavra() {
  const termo = document.getElementById("termoBusca").value.trim();
  if (!termo) {
    if (editoriaSelecionada === "Todas") {
      carregarTodasNoticiasAgrupadas();
    } else {
      carregarNoticiasEditoria(editoriaSelecionada);
    }
    return;
  }
  document.getElementById("noticias").innerHTML = "<p>Buscando not√≠cias...</p>";
  atualizarContador(0);
  // Busca s√≥ no Google News, mas poderia fazer por todos feeds (para simplificar)
  const rssBusca = `https://news.google.com/rss/search?q=${encodeURIComponent(termo)}&hl=pt-BR&gl=BR&ceid=BR:pt-419`;
  fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssBusca)}`)
    .then(response => response.json())
    .then(data => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "application/xml");
      noticiasAtuais = Array.from(xml.querySelectorAll("item"));
      noticiasAtuais.sort((a, b) => {
        const dateA = new Date(a.querySelector("pubDate")?.textContent || 0);
        const dateB = new Date(b.querySelector("pubDate")?.textContent || 0);
        return dateB - dateA;
      });
      const grupos = agruparPorDatas(noticiasAtuais);
      exibirNoticiasAgrupadas(grupos);
    })
    .catch(err => {
      document.getElementById("noticias").innerHTML = `<p>Erro ao buscar not√≠cias: ${err.message}</p>`;
    });
}

// Inicializa√ß√£o
window.onload = () => {
  atualizarMenuEditorias();
  carregarTodasNoticiasAgrupadas();
};
</script>
</body>
</html>
