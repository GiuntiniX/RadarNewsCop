<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Radar de Not√≠cias</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
      display: flex;
      min-height: 100vh;
      box-sizing: border-box;
    }
    .container-main {
      flex: 1 1 auto;
      max-width: 900px;
      margin: 0 auto;
      padding-bottom: 2em;
    }
    header {
      background: #1e1e1e;
      color: white;
      padding: 1em;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .titulo-radar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5em;
      font-size: 1.5em;
    }
    .titulo-radar img {
      width: 32px;
      height: 32px;
      vertical-align: middle;
    }
    .menu-editorias-set {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.4em;
      margin: 0.5em 0;
    }
    /* Cores para grupos de editorias */
    .menu-editorias button {
      border: none;
      border-radius: 6px 6px 0 0;
      padding: 0.5em 1em;
      margin: 0;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
      outline: none;
      color: #fff;
      box-shadow: 0 1px 3px #0005;
    }
    /* Grupo 1 */
    .cor-grupo1 { background: #00aced; }
    .cor-grupo1.selected, .cor-grupo1:hover { background: #47D2FF; color: #1e1e1e;}
    /* Grupo 2 */
    .cor-grupo2 { background: #00C853; }
    .cor-grupo2.selected, .cor-grupo2:hover { background: #6DF3A3; color: #1e1e1e;}
    /* Grupo 3 */
    .cor-grupo3 { background: #ff9100; }
    .cor-grupo3.selected, .cor-grupo3:hover { background: #ffd180; color: #1e1e1e;}
    /* Grupo 4 */
    .cor-grupo4 { background: #9c27b0; }
    .cor-grupo4.selected, .cor-grupo4:hover { background: #ce93d8; color: #1e1e1e;}
    /* Grupo 5 */
    .cor-grupo5 { background: #e53935; }
    .cor-grupo5.selected, .cor-grupo5:hover { background: #ff8a80; color: #1e1e1e;}
    /* Grupo 6 */
    .cor-grupo6 { background: #607d8b; }
    .cor-grupo6.selected, .cor-grupo6:hover { background: #b0bec5; color: #1e1e1e;}
    /* Grupo 7 */
    .cor-grupo7 { background: #03A9F4; }
    .cor-grupo7.selected, .cor-grupo7:hover { background: #81d4fa; color: #1e1e1e;}

    .busca {
      text-align: center;
      margin: 1em 0;
      flex-wrap: wrap;
      display: flex;
      gap: 0.5em;
      justify-content: center;
      align-items: center;
    }
    .busca button {
      padding: 0.5em 1em;
      background: #00aced;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      outline: none;
      font-weight: bold;
      font-size: 1em;
      transition: background 0.2s;
    }
    .busca button:hover {
      background: #0077a3;
    }
    .busca input {
      padding: 0.5em;
      width: 200px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .contador {
      text-align: center;
      font-weight: bold;
      margin: 1em 0 0.5em 0;
    }
    #refresh-timer {
      font-size:0.95em;
      color:#aaa;
      margin-top:0.5em;
      display: inline-block;
    }
    #btn-refresh {
      margin-left: 0.8em;
      background: #23272b;
      border: none;
      border-radius: 5px;
      color: #00aced;
      padding: 0.3em 1em;
      font-size: 1em;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
    }
    #btn-refresh:hover {
      background: #00aced;
      color: #fff;
    }
    #noticias {
      display: flex;
      flex-direction: column;
      gap: 1.2em;
      padding: 1em 0.5em;
    }
    .card {
      background: #ffffff;
      color: #000000;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(255,255,255,0.08);
      position: relative;
      border-left: 6px solid #00aced;
      margin-bottom: 0.8em;
      transition: border 0.2s;
    }
    .card h3 {
      margin: 0.5em 0 0.4em 0;
      font-size: 1.09em;
    }
    .card p {
      color: #333;
      font-size: 0.98em;
    }
    .card small {
      color: #666;
      font-size: 0.93em;
    }
    .main-layout {
      display: flex;
      flex-direction: row;
      width: 100%;
      min-height: 100vh;
    }
    .main-content {
      flex: 3 1 0%;
      margin-right: 2em;
      min-width: 0;
    }
    .sidebar-right {
      flex: 1 1 280px;
      background: #191b1c;
      border-left: 1px solid #222;
      padding: 1.2em 0.5em;
      min-width: 260px;
      max-width: 320px;
      color: #f0f0f0;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .sidebar-right h4 {
      text-align: center;
      margin: 0 0 0.8em 0;
      font-size: 1.13em;
      color: #00aced;
    }
    .sidebar-card {
      background: #23272b;
      color: #fff;
      border-radius: 7px;
      margin-bottom: 0.7em;
      padding: 0.7em 0.8em;
      font-size: 0.99em;
      box-shadow: 0 1px 6px #0003;
      border-left: 5px solid #00aced;
      position: relative;
    }
    .sidebar-card a {
      color: #47d2ff;
      text-decoration: underline;
      font-weight: bold;
    }
    .sidebar-card small {
      color: #aaa;
    }
    @media (max-width: 1000px) {
      .main-layout {
        flex-direction: column;
      }
      .sidebar-right {
        position: static;
        max-width: 100vw;
        min-width: 0;
        height: auto;
        border-left: none;
        border-top: 1px solid #222;
      }
      .main-content {
        margin-right: 0;
      }
    }
    @media (max-width: 600px) {
      .menu-editorias-set,
      .busca {
        flex-direction: column;
        gap: 0.2em;
      }
      .menu-editorias button {
        border-radius: 0;
        width: 100%;
      }
      .busca button,
      .busca input {
        width: 100%;
        margin-bottom: 0.2em;
      }
      .main-layout {
        flex-direction: column;
      }
      .sidebar-right {
        padding: 0.7em 0.1em;
      }
      .main-content {
        margin: 0;
      }
    }
  </style>
</head>
<body>
<div class="container-main">
  <header>
    <div class="titulo-radar">
      <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f6f0.png" alt="Radar Icon" />
      <span>Radar de Not√≠cias</span>
    </div>
    <div style="font-size:0.97em; margin-top:0.4em; color:#aaa;">
      Desenvolvido por: 
      <a href="mailto:guilherme.giuntini@telefonica.com" style="color:#00aced; text-decoration:underline;">
        Guilherme Giuntini
      </a>
    </div>
    <!-- MENU DE EDITORIAS EM DUAS LINHAS -->
    <nav id="menuEditorias1" class="menu-editorias-set"></nav>
    <nav id="menuEditorias2" class="menu-editorias-set"></nav>
    <div class="busca">
      <input type="text" id="termoBusca" placeholder="Buscar por palavra-chave">
      <button onclick="buscarPorPalavra()">Buscar</button>
    </div>
    <div class="contador" id="contador"></div>
    <div>
      <span id="refresh-timer"></span>
      <button id="btn-refresh" title="Atualizar agora" onclick="refreshNoticias()">üîÑ Atualizar</button>
    </div>
  </header>
  <div class="main-layout">
    <main id="noticias" class="main-content"></main>
    <aside class="sidebar-right">
      <h4>Mais Publicadas (√∫ltimas 5h)</h4>
      <div id="mais-publicadas"></div>
    </aside>
  </div>
</div>
<script>
// FEEDS PARA M√ÅXIMA COBERTURA: Google News com asterisco, editorias, sites grandes e regionais.
const feeds = [
  // Feeds hiper-abundantes, m√°ximo de fontes
  { nome: 'Tudo do Google News', url: 'https://news.google.com/rss/search?q=*&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 7 }, // TUDO
  { nome: 'Todas Not√≠cias', url: 'https://news.google.com/rss?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 7 }, // Recomendado pelo Google News

  // Editorias amplas, para garantir cobertura total
  { nome: 'Geral', url: 'https://news.google.com/rss/headlines/section/topic/NATION.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 1 },
  { nome: 'Brasil', url: 'https://news.google.com/rss/headlines/section/geo/Brasil?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 1 },
  { nome: 'Mundo', url: 'https://news.google.com/rss/headlines/section/topic/WORLD.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 1 },
  { nome: 'Pol√≠tica', url: 'https://news.google.com/rss/headlines/section/topic/POLITICS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 1 },
  { nome: 'Economia', url: 'https://news.google.com/rss/headlines/section/topic/BUSINESS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 1 },
  { nome: 'Opini√£o', url: 'https://news.google.com/rss/search?q=opini√£o&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 1 },

  // Editorias sociais e regionais
  { nome: 'Cidades', url: 'https://news.google.com/rss/search?q=cidade&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 2 },
  { nome: 'Pol√≠cia', url: 'https://news.google.com/rss/search?q=pol√≠cia&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 2 },
  { nome: 'Ci√™ncia', url: 'https://news.google.com/rss/headlines/section/topic/SCIENCE.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 2 },
  { nome: 'Sa√∫de', url: 'https://news.google.com/rss/headlines/section/topic/HEALTH.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 2 },
  { nome: 'Educa√ß√£o', url: 'https://news.google.com/rss/search?q=educa√ß√£o&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 2 },
  { nome: 'Meio Ambiente', url: 'https://news.google.com/rss/search?q=meio+ambiente&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 2 },
  { nome: 'Carreira', url: 'https://news.google.com/rss/search?q=carreira&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 2 },

  // Cultura, entretenimento e nichos
  { nome: 'Entretenimento', url: 'https://news.google.com/rss/headlines/section/topic/ENTERTAINMENT.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'Celebridades', url: 'https://news.google.com/rss/search?q=celebridades&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'A Fazenda', url: 'https://news.google.com/rss/search?q=a+fazenda&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'BBB', url: 'https://news.google.com/rss/search?q=bbb&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'Fofocas', url: 'https://news.google.com/rss/search?q=fofoca+celebridades&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'Arte', url: 'https://news.google.com/rss/search?q=arte&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'Culin√°ria', url: 'https://news.google.com/rss/search?q=culin√°ria&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'Moda', url: 'https://news.google.com/rss/search?q=moda&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'Turismo', url: 'https://news.google.com/rss/search?q=turismo&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },
  { nome: 'Religi√£o', url: 'https://news.google.com/rss/search?q=religi√£o&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 3 },

  // Esportes e subeditorias
  { nome: 'Esportes', url: 'https://news.google.com/rss/headlines/section/topic/SPORTS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },
  { nome: 'Futebol', url: 'https://news.google.com/rss/search?q=futebol&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },
  { nome: 'Futebol Feminino', url: 'https://news.google.com/rss/search?q=futebol+feminino&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },
  { nome: 'Campeonato Brasileiro', url: 'https://news.google.com/rss/search?q=campeonato+brasileiro&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },
  { nome: 'Libertadores', url: 'https://news.google.com/rss/search?q=libertadores&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },
  { nome: 'Champions League', url: 'https://news.google.com/rss/search?q=champions+league&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },
  { nome: 'NBA', url: 'https://news.google.com/rss/search?q=NBA&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },
  { nome: 'V√¥lei', url: 'https://news.google.com/rss/search?q=v√¥lei&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 4 },

  // Tecnologia, neg√≥cios e startups
  { nome: 'Tecnologia', url: 'https://news.google.com/rss/headlines/section/topic/TECHNOLOGY.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 5 },
  { nome: 'Startups', url: 'https://news.google.com/rss/search?q=startups&hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 5 },
  { nome: 'Neg√≥cios', url: 'https://news.google.com/rss/headlines/section/topic/BUSINESS.pt_br?hl=pt-BR&gl=BR&ceid=BR:pt-419', grupo: 5 },

  // Grandes portais e regionais
  { nome: 'Estad√£o', url: 'https://feeds.folha.uol.com.br/emcimadahora/rss091.xml', grupo: 6 },
  { nome: 'G1', url: 'https://g1.globo.com/rss/g1/', grupo: 6 },
  { nome: 'UOL', url: 'https://noticias.uol.com.br/ultimas/index.xml', grupo: 6 },
  { nome: 'Globo Esporte', url: 'https://globoesporte.globo.com/rss/ultimas.xml', grupo: 6 },
  { nome: 'Terra', url: 'https://www.terra.com.br/rss/0,,EI1,00.xml', grupo: 6 },
  { nome: 'R7', url: 'https://noticias.r7.com/rss', grupo: 6 }
];

// Separa√ß√£o para menus em duas linhas: metade em cima, metade embaixo
const dividirMenus = (() => {
  const grupos = [[],[],[],[],[],[],[]];
  feeds.forEach(f => grupos[f.grupo-1].push(f));
  // Agrupa por linha: grupos 1-4 e grupos 5-7
  return [
    grupos[0].concat(grupos[1]).concat(grupos[2]).concat(grupos[3]),
    grupos[4].concat(grupos[5]).concat(grupos[6])
  ];
})();

let noticiasAtuais = [];
let editoriaSelecionada = "Todas"; // "Todas" = todos os feeds

function atualizarContador(qtd) {
  document.getElementById("contador").textContent = `üî¢ Total de not√≠cias exibidas: ${qtd}`;
}
function formatarDataAMPM(dataStr) {
  if (!dataStr) return "";
  const data = new Date(dataStr);
  if (isNaN(data)) return "";
  return data.toLocaleString('pt-BR', {
    day: '2-digit', month: '2-digit', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
  }).replace(',', ' -');
}

// Renderiza√ß√£o de cards de not√≠cia (sem agrupamento, um a um)
function exibirNoticiasSimples(lista) {
  const noticias = document.getElementById("noticias");
  noticias.innerHTML = "";
  let total = 0;
  lista.forEach(item => {
    try {
      const title = item.querySelector("title").textContent;
      const link = item.querySelector("link").textContent;
      const description = item.querySelector("description")?.textContent || "";
      const pubDate = item.querySelector("pubDate")?.textContent || "";
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3><a href="${link}" target="_blank">${title}</a></h3>
        <small>${pubDate ? ('üïí ' + formatarDataAMPM(pubDate)) : ''}</small>
        <p>${description}</p>
      `;
      noticias.appendChild(card);
      total++;
    } catch (e) {}
  });
  atualizarContador(total);
}

// Carrega not√≠cias de todos os feeds, exibe uma a uma (sem agrupamento)
async function carregarTodasNoticiasSimples() {
  editoriaSelecionada = "Todas";
  atualizarMenuEditorias();
  document.getElementById("noticias").innerHTML = "<p>Carregando not√≠cias de todas as editorias...</p>";
  atualizarContador(0);

  let todasNoticias = [];
  let promessas = feeds.map(async feed => {
    try {
      const resp = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(feed.url)}`);
      const data = await resp.json();
      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "application/xml");
      const items = Array.from(xml.querySelectorAll("item"));
      todasNoticias = todasNoticias.concat(items);
    } catch (err) {
      // Ignora erro de feed individual
    }
  });
  await Promise.all(promessas);
  todasNoticias.sort((a, b) => {
    const dateA = new Date(a.querySelector("pubDate")?.textContent || 0);
    const dateB = new Date(b.querySelector("pubDate")?.textContent || 0);
    return dateB - dateA;
  });
  noticiasAtuais = todasNoticias;
  exibirNoticiasSimples(noticiasAtuais);
  atualizarMaisPublicadas();
}

// Carrega not√≠cias apenas de uma editoria espec√≠fica
async function carregarNoticiasEditoria(nomeEditoria) {
  editoriaSelecionada = nomeEditoria;
  atualizarMenuEditorias();
  document.getElementById("noticias").innerHTML = `<p>Carregando not√≠cias de <b>${nomeEditoria}</b>...</p>`;
  atualizarContador(0);

  const feed = feeds.find(f => f.nome === nomeEditoria);
  if (!feed) {
    carregarTodasNoticiasSimples();
    return;
  }
  try {
    const resp = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(feed.url)}`);
    const data = await resp.json();
    const parser = new DOMParser();
    const xml = parser.parseFromString(data.contents, "application/xml");
    noticiasAtuais = Array.from(xml.querySelectorAll("item"));
    noticiasAtuais.sort((a, b) => {
      const dateA = new Date(a.querySelector("pubDate")?.textContent || 0);
      const dateB = new Date(b.querySelector("pubDate")?.textContent || 0);
      return dateB - dateA;
    });
    exibirNoticiasSimples(noticiasAtuais);
    atualizarMaisPublicadas();
  } catch (err) {
    document.getElementById("noticias").innerHTML = `<p>Erro ao carregar not√≠cias!</p>`;
  }
}

// Atualiza os dois menus de editorias (metade em cima, metade embaixo)
function atualizarMenuEditorias() {
  const nav1 = document.getElementById("menuEditorias1");
  const nav2 = document.getElementById("menuEditorias2");
  nav1.innerHTML = "";
  nav2.innerHTML = "";
  // Adiciona bot√£o "Todas" em cima
  const btnTodas = document.createElement("button");
  btnTodas.textContent = "Todas";
  btnTodas.className = "cor-grupo1" + (editoriaSelecionada === "Todas" ? " selected" : "");
  btnTodas.onclick = () => carregarTodasNoticiasSimples();
  nav1.appendChild(btnTodas);
  // Metade em cima, metade embaixo, colorido por grupo
  dividirMenus[0].forEach(feed => {
    const btn = document.createElement("button");
    btn.textContent = feed.nome;
    btn.className = "cor-grupo"+feed.grupo + (editoriaSelecionada === feed.nome ? " selected" : "");
    btn.onclick = () => carregarNoticiasEditoria(feed.nome);
    nav1.appendChild(btn);
  });
  dividirMenus[1].forEach(feed => {
    const btn = document.createElement("button");
    btn.textContent = feed.nome;
    btn.className = "cor-grupo"+feed.grupo + (editoriaSelecionada === feed.nome ? " selected" : "");
    btn.onclick = () => carregarNoticiasEditoria(feed.nome);
    nav2.appendChild(btn);
  });
}

// Busca por palavra-chave em todos feeds do Google News (poderia ser em todos, mas para performance)
function buscarPorPalavra() {
  const termo = document.getElementById("termoBusca").value.trim();
  if (!termo) {
    if (editoriaSelecionada === "Todas") {
      carregarTodasNoticiasSimples();
    } else {
      carregarNoticiasEditoria(editoriaSelecionada);
    }
    return;
  }
  document.getElementById("noticias").innerHTML = "<p>Buscando not√≠cias...</p>";
  atualizarContador(0);
  const rssBusca = `https://news.google.com/rss/search?q=${encodeURIComponent(termo)}&hl=pt-BR&gl=BR&ceid=BR:pt-419`;
  fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssBusca)}`)
    .then(response => response.json())
    .then(data => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "application/xml");
      noticiasAtuais = Array.from(xml.querySelectorAll("item"));
      noticiasAtuais.sort((a, b) => {
        const dateA = new Date(a.querySelector("pubDate")?.textContent || 0);
        const dateB = new Date(b.querySelector("pubDate")?.textContent || 0);
        return dateB - dateA;
      });
      exibirNoticiasSimples(noticiasAtuais);
      atualizarMaisPublicadas();
    })
    .catch(err => {
      document.getElementById("noticias").innerHTML = `<p>Erro ao buscar not√≠cias: ${err.message}</p>`;
    });
}

// --- AUTO REFRESH DE 15 MINUTOS + Bot√£o refresh ---
let refreshInterval = 15 * 60; // segundos
let refreshCountdown = refreshInterval;
let refreshTimerId = null;

function atualizarTimerRefresh() {
  const el = document.getElementById('refresh-timer');
  if (!el) return;
  const min = Math.floor(refreshCountdown / 60);
  const sec = refreshCountdown % 60;
  el.textContent = `‚è≥ Atualiza√ß√£o autom√°tica em ${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
}

function iniciarAutoRefresh() {
  if (refreshTimerId) clearInterval(refreshTimerId);
  refreshCountdown = refreshInterval;
  atualizarTimerRefresh();
  refreshTimerId = setInterval(() => {
    refreshCountdown--;
    if (refreshCountdown <= 0) {
      refreshCountdown = refreshInterval;
      refreshNoticias();
    }
    atualizarTimerRefresh();
  }, 1000);
}
function refreshNoticias() {
  if (editoriaSelecionada === "Todas") {
    carregarTodasNoticiasSimples();
  } else {
    carregarNoticiasEditoria(editoriaSelecionada);
  }
  refreshCountdown = refreshInterval;
  atualizarTimerRefresh();
}

// --- LADO DIREITO: not√≠cias mais publicadas nas √∫ltimas 5 horas ---
async function atualizarMaisPublicadas() {
  const agora = new Date();
  const cincoHorasAtras = new Date(agora.getTime() - 5*60*60*1000);
  let titulos = {};
  noticiasAtuais.forEach(item => {
    try {
      const pubDate = item.querySelector("pubDate")?.textContent || "";
      const dataNoticia = new Date(pubDate);
      if (isNaN(dataNoticia) || dataNoticia < cincoHorasAtras) return;
      let title = item.querySelector("title")?.textContent?.trim() || "";
      let chave = title.toLowerCase().replace(/[^\w\s]/g,"").substring(0,110);
      if (!titulos[chave]) titulos[chave] = { count: 0, items: [], data: dataNoticia };
      titulos[chave].count++;
      titulos[chave].items.push(item);
      if (dataNoticia > titulos[chave].data) titulos[chave].data = dataNoticia;
    } catch(e){}
  });
  let lista = Object.values(titulos)
    .sort((a,b) => b.count - a.count || b.data - a.data)
    .slice(0,12);
  const maisPub = document.getElementById("mais-publicadas");
  maisPub.innerHTML = "";
  lista.forEach(entry => {
    const item = entry.items[0];
    const title = item.querySelector("title").textContent;
    const link = item.querySelector("link").textContent;
    const pubDate = item.querySelector("pubDate")?.textContent || "";
    const fonte = new URL(link).hostname.replace("www.","");
    maisPub.innerHTML += `
      <div class="sidebar-card">
        <a href="${link}" target="_blank">${title}</a><br>
        <small>üóûÔ∏è ${fonte} &bullet; ${formatarDataAMPM(pubDate)}</small>
        <div style="position:absolute; right:10px; top:10px; color:#47d2ff; font-weight:bold;">${entry.count > 1 ? "√ó"+entry.count : ""}</div>
      </div>
    `;
  });
}

// Inicializa√ß√£o
window.onload = () => {
  atualizarMenuEditorias();
  carregarTodasNoticiasSimples();
  iniciarAutoRefresh();
};
</script>
</body>
</html>
